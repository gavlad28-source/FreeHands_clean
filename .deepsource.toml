# ===============================
# üîß AUTO SETUP DEEPSOURCE CONFIG
# Author: Vlad + ChatGPT
# ===============================

Write-Host "üöÄ –ù–∞—á–∏–Ω–∞—é —É—Å—Ç–∞–Ω–æ–≤–∫—É DeepSource..." -ForegroundColor Cyan

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
if (-not (Test-Path "build.gradle")) {
    Write-Host "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω build.gradle ‚Äî –∑–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞!" -ForegroundColor Red
    exit 1
}

# –°–æ–∑–¥–∞—ë–º .deepsource.toml
$deepsourceConfig = @"
version = 1

[[analyzers]]
name = "kotlin"
enabled = true

  [analyzers.meta]
  runtime_version = "1.9"

[[analyzers]]
name = "java"
enabled = true

  [analyzers.meta]
  runtime_version = "17"

[[analyzers]]
name = "cpp"
enabled = true

  [analyzers.meta]
  standards = ["c++17"]

[[analyzers]]
name = "shell"
enabled = true

exclude_patterns = [
  ".gradle/**",
  ".idea/**",
  "build/**",
  "build-cache/**",
  "gradle/**",
  "gradle-temp/**",
  "backup_*/**",
  "src.backup/**",
  "**/generated/**",
  "docs/**"
]

[[transformers]]
name = "autopep8"
enabled = true
"@

Set-Content -Path ".deepsource.toml" -Value $deepsourceConfig -Encoding UTF8

Write-Host "‚úÖ –§–∞–π–ª .deepsource.toml —Å–æ–∑–¥–∞–Ω." -ForegroundColor Green

# –î–æ–±–∞–≤–ª—è–µ–º –≤ Git
git add .deepsource.toml

# –î–µ–ª–∞–µ–º commit
git commit -m "Add DeepSource configuration for Kotlin, Java, C++, PowerShell"

# Push –≤ GitHub
git push origin main

Write-Host "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ GitHub." -ForegroundColor Green

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ
Write-Host ""
Write-Host "üåê –¢–µ–ø–µ—Ä—å –∑–∞–π–¥–∏ –Ω–∞ https://deepsource.com" -ForegroundColor Yellow
Write-Host "   –í–æ–π–¥–∏ —á–µ—Ä–µ–∑ GitHub ‚Üí –≤—ã–±–µ—Ä–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π 'gavlad28-source/FreeHands_clean'" -ForegroundColor Yellow
Write-Host "   DeepSource –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç .deepsource.toml –∏ –Ω–∞—á–Ω—ë—Ç –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞." -ForegroundColor Yellow
Write-Host ""
Write-Host "üí° –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—è–π —Ä–∞–∑–¥–µ–ª 'Issues' –≤ DeepSource —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–∏–Ω—É—Ç." -ForegroundColor Cyan
